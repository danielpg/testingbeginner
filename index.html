<html>
<head>
<script type="text/javascript"  src="cordova.js"></script>
<script src="js/jquery-2.1.3.min.js"></script>

<script type="text/javascript" charset="utf-8" src="SQLitePlugin.js"></script>
<script>
var pictureSource;   // picture source
var destinationType; // sets the format of returned value
 
document.addEventListener("deviceready", onDeviceReady, false);
 
function onDeviceReady() {
		alert("onDeviceReady");

    //pictureSource = navigator.camera.PictureSourceType;
    //destinationType = navigator.camera.DestinationType;

	var db = window.sqlitePlugin.openDatabase({name: "mysqlitedb.db"});
	
	//db.transaction(populateDB, errorCB, successCB);
	db.transaction(function(tx) {
		alert("transaction");

		$("#test3").append("qqq" );
		$("#test3").append("xxxx" );

		tx.executeSql("select bar from foo;", [], function(tx, res) {
			alert("readdsqlwhite");
			$("#test2").append("res.rows: " + res.rows.item(0).bar + "<br>" );
			//$("#test2").append("res.rows.item(0): " + res.rows.item(0) + "<br>" );
		});
	},function(tx,err){
      alert("Error " + err.message);
	});

}
/*
 function onDeviceReady() {
        var db = window.sqlitePlugin.openDatabase("Database", "1.0", "Demo", -1);

        db.transaction(function(tx) {
          tx.executeSql('DROP TABLE IF EXISTS test_table');
          tx.executeSql('CREATE TABLE IF NOT EXISTS test_table (id integer primary key, data text, data_num integer)');

          tx.executeSql("INSERT INTO test_table (data, data_num) VALUES (?,?)", ["test", 100], function(tx, res) {
          console.log("insertId: " + res.insertId + " -- probably 1"); // check #18/#38 is fixed
          alert("insertId: " + res.insertId + " -- should be valid");

            db.transaction(function(tx) {
              tx.executeSql("SELECT data_num from test_table;", [], function(tx, res) {
                console.log("res.rows.length: " + res.rows.length + " -- should be 1");
                alert("res.rows.item(0).data_num: " + res.rows.item(0).data_num + " -- should be 100");
              });
            });

          }, function(e) {
            console.log("ERROR: " + e.message);
          });
        });
}
 */
function clearCache() {
    navigator.camera.cleanup();
}
 
var retries = 0;
function onCapturePhoto(fileURI) {
    var win = function (r) {
        clearCache();
        retries = 0;
        alert('Done!');
    }
 
    var fail = function (error) {
        if (retries == 0) {
            retries ++
            setTimeout(function() {
                onCapturePhoto(fileURI)
            }, 1000)
        } else {
            retries = 0;
            clearCache();
            alert('Ups. Something wrong happens!');
        }
    }
 
    var options = new FileUploadOptions();
    options.fileKey = "file";
    options.fileName = fileURI.substr(fileURI.lastIndexOf('/') + 1);
    options.mimeType = "image/jpeg";
    options.params = {}; // if we need to send parameters to the server request
    var ft = new FileTransfer();
    //ft.upload(fileURI, encodeURI("http://host/upload"), win, fail, options);
}
 
function capturePhoto() {
		alert("f_capture_photo");
    navigator.camera.getPicture(onCapturePhoto, onFail, {
        quality: 100,
        destinationType: destinationType.FILE_URI
    });
}
 
function onFail(message) {
    alert('Failed because: ' + message);
}

 function get_gps() {
		alert("get_gps");
        navigator.geolocation.getCurrentPosition(onSuccess_gps, onError_gps);
    }

    // onSuccess Geolocation
    //
function onSuccess_gps(position) {
		alert("onsuccess_gps");
    var element = document.getElementById('test1');
    element.innerHTML = 'Latitude: '           + position.coords.latitude              + '<br />' +
                        'Longitude: '          + position.coords.longitude             + '<br />' +
                        'Altitude: '           + position.coords.altitude              + '<br />' +
                        'Accuracy: '           + position.coords.accuracy              + '<br />' +
                        'Altitude Accuracy: '  + position.coords.altitudeAccuracy      + '<br />' +
                        'Heading: '            + position.coords.heading               + '<br />' +
                        'Speed: '              + position.coords.speed                 + '<br />' +
                        'Timestamp: '          +                                   position.timestamp          + '<br />';
}

function onError_gps(error) {
    alert('code: '    + error.code    + '\n' +
          'message: ' + error.message + '\n');
}

</script>
</head>
<style>
</style>
<body>
<input type="button" onclick="capturePhoto();" value="Foto" name="Foto" /><br>
<input type="button" onclick="get_gps();" value="GPS" name="GPS" /><br>
<input type="button"  value="Save File" name="Save File" /><br>
<div id="test1"></div>
<div id="test2"></div>
<div id="test3"></div>
<div id="test4"></div>

</body>
</html>
